# frozen_string_literal: true

# This is generated code!

module <%= module_name %>
  module Plugins
     # Protocol plugin - allows user to configure protocol on client.
     # @api private
     class Protocol < Smithy::Client::Plugin
       option(
         :protocol,
<% if protocol -%>
         doc_default: '<%= protocol %>',
         doc_type: '<%= protocol %>',
         docstring: <<~DOCS) do |_cfg|
           Allows you to overwrite default protocol. The given protocol
           must provide the following functionalities:
           - `build_request`
           - `parse_response`
           - `parse_error`
           See existing protocols within Smithy::Client::Protocols for examples.
         DOCS
         <%= protocol %>.new
       end
<% else -%>
         default: nil,
         docstring: <<~DOCS)
           This configuration is required to build requests and parse responses.
           In Smithy, a protocol is a named set of rules that defines the syntax
           and semantics of how a client and server communicate. The given protocol
           must provide the following functionalities:
           - `build_request`
           - `parse_response`
           - `parse_error`
           See existing protocols within Smithy::Client::Protocols for examples.
         DOCS
<% end -%>

       def add_handlers(handlers, config)
         handlers.add(Smithy::Client::Handlers::Build)
         handlers.add(Smithy::Client::Handlers::Parse)
         # TODO: Requires error handling to be implemented
         # handlers.add(Smithy::Client::Handlers::Error, step: :sign)
       end
     end
  end
end
